{% extends "base.html" %}

{% set active_page = 'predict' %}

{% block title %}Analysis - AI Insight{% endblock %}

{% block content %}
<div class="breadcrumb">Inference / Image Analysis</div>
<h1>Image Analysis</h1>
<p style="margin-bottom: 2.5rem; color: var(--text-muted);">Upload a hotel inventory image to run automated object
    detection.</p>

<div class="card form-section shadow-sm">
    <form action="/predict" method="post" enctype="multipart/form-data" id="predict-form">
        <div class="predict-dropzone" onclick="document.getElementById('file-input').click()">
            <input type="file" id="file-input" name="file" accept="image/*" style="display: none;"
                onchange="previewImage(this)">

            <div id="upload-content">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                <h3 style="margin-bottom: 0.5rem;">Choose a file or drag & drop</h3>
                <p style="color: var(--text-muted);">Supports JPG, PNG, WEBP (Max 5MB)</p>
            </div>

            <img id="preview"
                style="max-width: 100%; max-height: 400px; display: none; margin: 1rem auto; border-radius: var(--radius); border: 2px solid var(--border-color); box-shadow: var(--shadow-md);">
        </div>

        <div style="margin-top: 2rem; display: flex; justify-content: center;">
            <button type="submit" class="btn btn-lg" style="max-width: 400px;">
                <span style="margin-right: 0.5rem;">üéØ</span> Run AI Analysis
            </button>
        </div>
    </form>

    {% if error %}
    <div class="alert"
        style="margin-top: 2rem; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); border: 2px solid rgba(239, 68, 68, 0.3); color: #dc2626; padding: 1.5rem; border-radius: var(--radius); animation: fadeIn 0.5s ease;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 1.5rem;">‚ö†Ô∏è</div>
            <div>
                <strong style="display: block; margin-bottom: 0.25rem; font-size: 1.1rem;">Analysis Failed</strong>
                <span style="font-size: 0.95rem;">{{ error }}</span>
            </div>
        </div>
    </div>
    {% endif %}

    {% if prediction and not error %}
    <div class="result-container">
        <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
            <div
                style="background: white; padding: 1.25rem; border-radius: 50%; font-size: 2rem; box-shadow: var(--shadow-md);">
                üéØ</div>
            <div style="flex: 1;">
                <div
                    style="color: #059669; font-weight: 700; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">
                    Detection
                    Result</div>
                <div style="font-size: 2.5rem; font-weight: 800; color: #047857;">{{ prediction|upper }}</div>
            </div>
            <div style="text-align: right;">
                <div style="color: var(--text-muted); font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">
                    Confidence</div>
                <div style="font-size: 2rem; font-weight: 800; color: #10b981;">{{ (confidence * 100)|round(1) }}%
                </div>
            </div>
        </div>

        <div class="result-actions">
            <button type="button" class="btn btn-clear" onclick="clearPredictionResult()">
                <span style="margin-right: 0.5rem;">üîÑ</span> Clear Result
            </button>
            <button type="button" class="btn" onclick="clearPredictionResult()">
                <span style="margin-right: 0.5rem;">üì∏</span> Predict Another Image
            </button>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('upload-content').style.display = 'none';
                var preview = document.getElementById('preview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}